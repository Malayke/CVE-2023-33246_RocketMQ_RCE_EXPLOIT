import socket
import json
ip = '127.0.0.1'
port = 9876
data1 = '000000c7000000c37b22636f6465223a3130352c226578744669656c6473223a7b225369676e6174757265223a222f7535502f775a5562686a616e75344c4d2f557a45646f327532493d222c22746f706963223a22544257313032222c224163636573734b6579223a22726f636b65746d7132227d2c22666c6167223a302c226c616e6775616765223a224a415641222c226f7061717565223a312c2273657269616c697a655479706543757272656e74525043223a224a534f4e222c2276657273696f6e223a3430317d'
data2 = '000000b6000000b27b22636f6465223a3130362c226578744669656c6473223a7b225369676e6174757265223a224f7531543538524963795a57615449777a6b684a5a576e2f5a76733d222c224163636573734b6579223a22726f636b65746d7132227d2c22666c6167223a302c226c616e6775616765223a224a415641222c226f7061717565223a302c2273657269616c697a655479706543757272656e74525043223a224a534f4e222c2276657273696f6e223a3430317d'
# Create a socket object
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

# Connect to the server at the specified IP and port
s.connect((ip, port))

# Send the payload
s.sendall(bytes.fromhex(data1))
resp = s.recv(1024)
# Close the socket
s.close()
data = resp[8:].decode()
p1,p2 = data.split('}{')
p1 += '}'
status = json.loads(p1)
version = int(status.get('version'))
if version < 433:
    print(f"{ip} Vulnerable to CVE-2023-33246 RocketMQ RCE")
else:
    print(f"{ip} Not Vulnerable to CVE-2023-33246 RocketMQ RCE")


